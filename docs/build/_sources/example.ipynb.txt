{"cells":[{"source":["# \"\"\"\n","# Created on Wed Feb 13 15:37:43 2019\n","\n","# @author: Semeon Risom\n","# @email: semeon.risom@gmail.com.\n","\n","# Sample code to run SR Research Eyelink eyetracking system. Code is optimized for the Eyelink 1000 Plus (5.0),\n","# but should be compatiable with earlier systems.\n","# \"\"\""],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# imports\n","from psychopy import visual\n","import mdl"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Initialize the Eyelink.\n","subject = 1\n","eyetracking = mdl.eyetracking(libraries=False, subject=subject)"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Setting the dominant eye. This step is especially critical for transmitting gaze coordinates from Eyelink->Psychopy. \n","dominant_eye = 'left'\n","eye_used = eyetracking.set_eye_used(eye=dominant_eye)"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Start calibration.\n","# Before running the calibration, ensure psychopy window instance has been created in the experiment file. \n","# This window will be used in the calibration function.\n","#\n","# ```psychopy.visual.window.Window``` instance\n","window = visual.Window(size=[1336, 768], fullscr=False, screen=0, allowGUI=True, \n","                       allowStencil=False, monitor=u'testMonitor', \n","                       color=(128,128,128), colorSpace='rgb', blendMode='avg')\n","# start\n","eyetracking.calibration(window=window)"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Enter the key \"o\" on the ```psychopy.visual.window.Window``` instance. This will begin the task. \n","# The Calibration, Validation, 'task-start' events are controlled by the keyboard.\n","# Calibration (\"c\"), Validation (\"v\"), task-start (\"o\") respectively."],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# (Optional) Print message to console/terminal. This may be useful for debugging issues.\n","eyetracking.console(c=\"green\", msg=\"eyetracking.calibration() started\")"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Start recording. This should be run at the start of the trial. \n","# Note: There is an intentional delay of 150 msec to allow the Eyelink to buffer gaze samples.\n","\n","eyetracking.start_recording(trial=1, block=1)"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Collects new gaze coordinates from Eyelink (only if needed in experiment). This command should be \n","# looped at an interval of sample/2.01 msec to prevent oversampling (500Hz).\n","import time\n","s1 = 0 # set current time to 0\n","lgxy = [] # create list of gaze coordinates (demonstration purposes only)\n","s0 = time.clock() # initial timestamp\n","while True:\n","    # if difference between starting and current time is greater than > 2.01 msec, collect new sample\n","    if (s1 - s0) >= .00201:\n","        gxy = eyetracking.sample(eye_used=eye_used) # get gaze coordinates\n","        lgxy.append(gxy) # store in list\n","        s0 = time.clock() # update starting time\n","    #else set current time\n","    else: \n","        s1 = time.clock()\n","\n","    #break `while` statement if list of gaze coordiantes >= 20 (demonstration purposes only)\n","    if len(lgxy) >= 20: break"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Send messages to Eyelink. This allows post-hoc processing of timing related events (i.e. \"stimulus onset\").\n","# Sending message \"stimulus onset\".\n","msg = \"stimulus onset\"\n","eyetracking.send_message(msg=msg)"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Stops Eyelink recording. Also allows transmission of trial-level variables (optional) to Eyelink.\n","# Note: Variables sent are optional. If they being included, they must be in ```python dict``` format.\n","variables = dict(stimulus='001B_F.jpg', trial_type='encoding', race=\"black\")\n","eyetracking.stop_recording(trial=1, block=1, variables=variables)"],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0},{"source":["# Finish Eyelink recording.\n","eyetracking.finish_recording()\n",""],"cell_type":"code","outputs":[],"metadata":{},"execution_count":0}],"nbformat":4,"nbformat_minor":2,"metadata":{"language_info":{"name":"python","codemirror_mode":{"name":"ipython","version":3}},"orig_nbformat":2,"file_extension":".py","mimetype":"text/x-python","name":"python","npconvert_exporter":"python","pygments_lexer":"ipython3","version":3}}